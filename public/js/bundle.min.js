!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),r=io(),a=new i.default(r,document.getElementById("game"));document.addEventListener("DOMContentLoaded",a.init()),r.on("connect",function(){r.emit("new player"),a.playerId=r.io.engine.id}),r.on("state",function(e){a.render(e)})},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=i(n(2)),s=i(n(4)),u=i(n(5)),c=function(){function e(t,n){r(this,e),this.socket=t,this.canvas=n,this.inputManager=new s.default(n),this.assetManager=new o.default,this.spritesLoaded=!1,this.ctx=null,this.playerId=null,this.animations={},this.registerLoop()}return a(e,[{key:"registerLoop",value:function(){window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}},{key:"init",value:function(){var e=this;this.canvas.getContext?(this.socket.emit("new player"),this.ctx=this.canvas.getContext("2d"),this.assetManager.queueDownload("ambient","assets/audio/ambient/ambient.mp3","audio"),this.assetManager.queueDownload("jump","assets/audio/effects/jump.wav","audio"),this.assetManager.queueDownload("background","assets/textures/background.png","texture"),this.assetManager.queueDownload("player","assets/textures/player.png","texture"),this.assetManager.queueDownload("stone","assets/textures/stone-block.jpg","texture"),this.assetManager.queueDownload("heart","assets/textures/heart.png","texture"),this.assetManager.queueDownload("coin","assets/textures/coin.png","texture"),this.assetManager.queueDownload("playerSheet","assets/textures/test.png","spriteSheet",{frameWidth:32,frameHeight:64}),this.assetManager.queueDownload("coinSheet","assets/textures/coin-sprite-animation-sprite-sheet.png","spriteSheet",{frameWidth:44,frameHeight:44}),this.assetManager.loadAll(function(){e.animations.right=new u.default(e.assetManager.getSpriteSheet("playerSheet"),3,3,6,12),e.animations.left=new u.default(e.assetManager.getSpriteSheet("playerSheet"),3,3,6,12),e.animations.idle=new u.default(e.assetManager.getSpriteSheet("playerSheet"),10,0,2,12),e.animations.coin=new u.default(e.assetManager.getSpriteSheet("coinSheet"),3,0,9),e.animations.current=e.animations.left,e.assetManager.playSound("ambient",!0),e.update(),document.getElementById("background").getContext("2d").drawImage(e.assetManager.getSprite("background"),0,0,e.canvas.width,e.canvas.height),e.spritesLoaded=!0})):document.getElementById("unsupported").textContent="Please update your browser or download another one which supports HTML5"}},{key:"update",value:function(){var e=this;this.socket.emit("input",this.inputManager.registeredInputs),window.requestAnimationFrame(function(){return e.update()})}},{key:"render",value:function(e){var t=this;if(this.playerId&&e[this.playerId]&&this.spritesLoaded){var n=e[this.playerId];(this.inputManager.registeredInputs.w||this.inputManager.registeredInputs[" "])&&!n.jumping&&n.grounded&&this.assetManager.playSound("jump"),this.animations.current.update(),this.animations.coin.update(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),Object.keys(e).forEach(function(i){var r=e[i];r.viewport.areaId===n.viewport.areaId&&(r.registeredInputs.a&&(t.animations.current=t.animations.left),r.registeredInputs.d&&(t.animations.current=t.animations.right),r.registeredInputs.d||r.registeredInputs.a||(t.animations.current=t.animations.idle),t.animations.current.draw(t.ctx,r.position._x,r.position._y,r.width,r.height))}),e[this.playerId].viewport.blocks.forEach(function(e){"stone"===e.type?t.ctx.drawImage(t.assetManager.getSprite(e.type),e.position._x,e.position._y,e.width,e.height):"coin"===e.type&&t.animations.coin.draw(t.ctx,e.position._x,e.position._y,e.width,e.height)});for(var i=this.canvas.width-35,r=0;r<e[this.playerId].lives;r++)this.ctx.drawImage(this.assetManager.getSprite("heart"),i,5,30,30),i-=30;this.ctx.drawImage(this.assetManager.getSprite("coin"),5,5,30,30),this.ctx.font="30px serif",this.ctx.fillStyle="red",this.ctx.fillText(e[this.playerId].coins.toString(),35,30)}}}]),e}();t.default=c},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(n(3)),o=function(){function e(){i(this,e),this.cache={audio:[],sprite:[],spriteSheet:[]},this.bufferCache=[],this.queue=[],this.succesCount=0,this.errorCount=0,this.initAudioContext()}return r(e,[{key:"initAudioContext",value:function(){try{window.AudioContext=window.AudioContext||window.webkitAudioContext,this.context=new AudioContext}catch(e){alert("Web Audio API is not supported in this browser")}}},{key:"queueDownload",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.queue.push({name:e,path:t,type:n,opts:i})}},{key:"loadAll",value:function(e){var t=this;0===this.queue.length&&e(),this.queue.forEach(function(n){"audio"===n.type?t.loadAudio(n,e):"texture"===n.type?t.loadSprite(n,e):"spriteSheet"===n.type&&t.loadSpriteSheet(n,e)})}},{key:"loadAudio",value:function(e,t){var n=this,i=new XMLHttpRequest;i.open("GET",e.path,!0),i.responseType="arraybuffer",i.onload=function(){n.context.decodeAudioData(i.response,function(i){n.cache.audio[e.name]=i,n.succesCount+=1,n.done()&&t()})},i.onerror=function(){n.errorCount+=1,n.done()&&t()},i.send()}},{key:"loadSprite",value:function(e,t){var n=this,i=new Image;i.addEventListener("load",function(){n.succesCount+=1,n.done()&&t()},!1),i.addEventListener("error",function(){n.errorCount+=1,n.done()&&t()},!1),i.src=e.path,this.cache.sprite[e.name]=i}},{key:"loadSpriteSheet",value:function(e,t){this.cache.spriteSheet[e.name]=new a.default(e.path,e.opts.frameWidth||0,e.opts.frameHeight||0),this.succesCount+=1,this.done()&&t()}},{key:"getSprite",value:function(e){return this.cache.sprite[e]}},{key:"getSpriteSheet",value:function(e){return this.cache.spriteSheet[e]}},{key:"playSound",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.context.createBufferSource();n.buffer=this.cache.audio[e],n.connect(this.context.destination),t&&(n.loop=t,n.loopEnd=Math.floor(n.buffer.duration)),n.start(0)}},{key:"done",value:function(){return this.queue.length===this.succesCount+this.errorCount}}]),e}();t.default=o},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t,n,r){var a=this;i(this,e),this._image=new Image,this._image.addEventListener("load",function(){a._framesPerRow=Math.floor(a._image.width/a._frameWidth)}),this._image.src=t,this._sourcePath=t,this._frameWidth=n,this._frameHeight=r}return r(e,[{key:"sourcePath",get:function(){return this._sourcePath},set:function(e){if("string"!=typeof e)throw new Error("Param sourcePath must be of type number!");this._sourcePath=e}},{key:"frameWidth",get:function(){return this._frameWidth},set:function(e){if("number"!=typeof e)throw new Error("Param frameWidth must be of type number!");this._frameWidth=e}},{key:"frameHeight",get:function(){return this._frameHeight},set:function(e){if("number"!=typeof e)throw new Error("Param frameHeight must be of type number!");this._frameHeight=e}},{key:"image",get:function(){return this._image},set:function(e){if(!(e instanceof Image))throw new Error("Param image must be of type Image!");this._image=e}},{key:"framesPerRow",get:function(){return this._framesPerRow},set:function(e){this._framesPerRow=e}}]),e}();t.default=a},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(){i(this,e),this.initializeKeyHandler(),this.initializeTouchHandler(),this.registeredInputs={}}return r(e,[{key:"initializeKeyHandler",value:function(){var e=this;window.addEventListener("keydown",function(t){e.registeredInputs[t.key]=!0},!1),window.addEventListener("keyup",function(t){e.registeredInputs[t.key]=!1},!1)}},{key:"initializeTouchHandler",value:function(){window.addEventListener("touchstart",function(n){n.preventDefault(),e=n.touches[0].clientX,t=n.touches[0].clientY},!1),window.addEventListener("touchmove",function(i){if(i.preventDefault(),e&&t){var r=i.touches[0].clientX,a=i.touches[0].clientY,o=t-a;e-r>0?n.registeredInputs.a=!0:n.registeredInputs.d=!0,o>0&&(n.registeredInputs.w=!0),e=null,t=null}},!1),window.addEventListener("touchend",function(e){e.preventDefault(),Object.keys(n.registeredInputs).forEach(function(e){n.registeredInputs[e]=!1})},!1);var e=null,t=null,n=this}}]),e}();t.default=a},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t,n,r,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;i(this,e),this.spriteSheet=t,this.speed=n,this.sequence=[],this.currentFrame=0,this.counter=0,this.offsetBottom=o;for(var s=r;s<=a;s++)this.sequence.push(s)}return r(e,[{key:"update",value:function(){this.counter===this.speed-1&&(this.currentFrame=(this.currentFrame+1)%this.sequence.length),this.counter=(this.counter+1)%this.speed}},{key:"draw",value:function(e,t,n,i,r){var a=Math.floor(this.sequence[this.currentFrame]/this.spriteSheet.framesPerRow),o=Math.floor(this.sequence[this.currentFrame]%this.spriteSheet.framesPerRow);e.drawImage(this.spriteSheet.image,o*this.spriteSheet.frameWidth,a*this.spriteSheet.frameHeight,this.spriteSheet.frameWidth,this.spriteSheet.frameHeight-this.offsetBottom,t,n,i,r)}}]),e}();t.default=a}]);
//# sourceMappingURL=bundle.min.js.map

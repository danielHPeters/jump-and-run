{"version":3,"sources":["webpack:/webpack/bootstrap 2402eded549bdfef3db0","webpack:///src/client/app.js","webpack:///src/client/application/AudioManager.js","webpack:///src/client/application/AssetManager.js","webpack:///src/client/application/KeyboardEventHandler.js"],"names":["__webpack_require__","moduleId","installedModules","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","animate","socket","emit","keyEventHandler","keyActionsRegister","window","requestAnimationFrame","io","canvas","document","getElementById","_KeyboardEventHandler2","default","audioManager","_AudioManager2","assetManager","_AssetManager2","ctx","on","game","console","log","clearRect","width","height","players","forEach","player","currentArea","playerId","drawImage","getAsset","material","position","x","y","blocks","block","addEventListener","queueDownload","loadAll","playSound","downLoadAll","data","getContext","textContent","AudioManager","_classCallCheck","this","bufferCache","downloadQueue","succesCount","errorCount","AudioContext","webkitAudioContext","context","e","alert","path","push","callback","length","managerInstance","item","load","url","instance","request","XMLHttpRequest","open","responseType","onload","decodeAudioData","response","buffer","done","onerror","send","loop","arguments","undefined","sound","createBufferSource","connect","destination","loopEnd","Math","floor","duration","start","AssetManager","cache","_this","img","Image","src","KeyboardEventHandler","initializeKeyHandler","event","key"],"mappings":"aAIA,SAAAA,EAAAC,GAGA,GAAAC,EAAAD,GACA,OAAAC,EAAAD,GAAAE,QAGA,IAAAC,EAAAF,EAAAD,IACAI,EAAAJ,EACAK,GAAA,EACAH,YAUA,OANAI,EAAAN,GAAAO,KAAAJ,EAAAD,QAAAC,EAAAA,EAAAD,QAAAH,GAGAI,EAAAE,GAAA,EAGAF,EAAAD,QAvBA,IAAAD,KA4BAF,EAAAS,EAAAF,EAGAP,EAAAU,EAAAR,EAGAF,EAAAW,EAAA,SAAAR,EAAAS,EAAAC,GACAb,EAAAc,EAAAX,EAAAS,IACAG,OAAAC,eAAAb,EAAAS,GACAK,cAAA,EACAC,YAAA,EACAC,IAAAN,KAMAb,EAAAoB,EAAA,SAAAhB,GACA,IAAAS,EAAAT,GAAAA,EAAAiB,WACA,WAA2B,OAAAjB,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAJ,EAAAW,EAAAE,EAAA,IAAAA,GACAA,GAIAb,EAAAc,EAAA,SAAAQ,EAAAC,GAAsD,OAAAR,OAAAS,UAAAC,eAAAjB,KAAAc,EAAAC,IAGtDvB,EAAA0B,EAAA,GAGA1B,EAAAA,EAAA2B,EAAA,qFC5BA,SAASC,IAEPC,EAAOC,KAAK,WAAYC,EAAgBC,oBAGxCC,OAAOC,sBAAsB,WAAA,OAAMN,MApCrC,QAAA5B,EAAA,QACAA,EAAA,QACAA,EAAA,IAEI6B,EAASM,KACTC,EAASC,SAASC,eAAe,QACjCP,EAAkB,IAAAQ,EAAAC,QAAyBJ,GAC3CK,EAAe,IAAAC,EAAAF,QACfG,EAAe,IAAAC,EAAAJ,QAEfK,OAAAA,EAEJhB,EAAOiB,GAAG,QAAS,SAAAC,GACjBC,QAAQC,IAAI,iBACZJ,EAAIK,UAAU,EAAG,EAAGd,EAAOe,MAAOf,EAAOgB,QACzCJ,QAAQC,IAAIF,GACZA,EAAKM,QAAQC,QAAQ,SAAAC,GACfA,EAAOC,cAAgBT,EAAKM,aARhCI,GAQkDD,aAChDX,EAAIa,UAAUf,EAAagB,SAASJ,EAAOK,SAAShD,MAAO2C,EAAOM,SAASC,EAAGP,EAAOM,SAASE,EAAGR,EAAOJ,MAAOI,EAAOH,UAG1HL,EAAKM,aAZHI,GAYqBD,YAAYQ,OAAOV,QAAQ,SAAAW,GAChDpB,EAAIa,UAAUf,EAAagB,SAASM,EAAML,SAAShD,MAAOqD,EAAMJ,SAASC,EAAGG,EAAMJ,SAASE,EAAGE,EAAMd,MAAOc,EAAMb,YAwCrHf,SAAS6B,iBAAiB,oBAnBxBzB,EAAa0B,cAAc,UAAW,oCACtC1B,EAAa0B,cAAc,OAAQ,sCACnC1B,EAAa2B,QAAQ,WACnB3B,EAAa4B,UAAU,WAAW,GAGlC1B,EAAawB,cAAc,aAAc,kCACzCxB,EAAawB,cAAc,SAAU,8BACrCxB,EAAawB,cAAc,cAAe,mCAC1CxB,EAAawB,cAAc,QAAS,6BAIpCxB,EAAa2B,YAAY,WACvBzC,EAAOC,KAAK,oBAOlBD,EAAOiB,GAAG,UAAW,SAAUyB,GAC7BvB,QAAQC,IAAIsB,KAGd1C,EAAOiB,GAAG,oBAAqB,SAAAyB,GACzBnC,EAAOoC,YACT3B,EAAMT,EAAOoC,WAAW,MACxB5C,KAEAS,SAASC,eAAe,eAAemC,YAAc,kfC3EpCC,aACnB,SAAAA,IAAeC,EAAAC,KAAAF,GACbE,KAAKC,eACLD,KAAKE,iBACLF,KAAKG,YAAc,EACnBH,KAAKI,WAAa,EAElB,IAEE/C,OAAOgD,aAAehD,OAAOgD,cAAgBhD,OAAOiD,mBACpDN,KAAKO,QAAU,IAAIF,aACnB,MAAOG,GACPC,MAAM,mGASKzE,EAAM0E,GACnBV,KAAKE,cAAcS,MAAM3E,KAAMA,EAAM0E,KAAMA,oCAGpCE,GAC2B,IAA9BZ,KAAKE,cAAcW,QACrBD,IAEF,IAAIE,EAAkBd,KACtBA,KAAKE,cAAcxB,QAAQ,SAAAqC,GACzBD,EAAgBE,KAAKD,EAAK/E,KAAM+E,EAAKL,KAAME,kCAIzC5E,EAAMiF,EAAKL,GACf,IAAIM,EAAWlB,KACXmB,EAAU,IAAIC,eAElBD,EAAQE,KAAK,MAAOJ,GAAK,GACzBE,EAAQG,aAAe,cAGvBH,EAAQI,OAAS,WACfL,EAASX,QAAQiB,gBACfL,EAAQM,SAAU,SAAAC,GAChBR,EAASjB,YAAYjE,GAAQ0F,EAC7BR,EAASf,aAAe,EAEpBe,EAASS,QACXf,OAMRO,EAAQS,QAAU,WAChBV,EAASd,YAAc,EAEnBc,EAASS,QACXf,KAGJO,EAAQU,yCAGC7F,GAAoB,IAAd8F,EAAcC,UAAAlB,OAAA,QAAAmB,IAAAD,UAAA,IAAAA,UAAA,GACzBE,EAAQjC,KAAKO,QAAQ2B,qBAEzBD,EAAMP,OAAS1B,KAAKC,YAAYjE,GAChCiG,EAAME,QAAQnC,KAAKO,QAAQ6B,aACvBN,IACFG,EAAMH,KAAOA,EACbG,EAAMI,QAAUC,KAAKC,MAAMN,EAAMP,OAAOc,WAE1CP,EAAMQ,MAAM,kCAQZ,OAAOzC,KAAKE,cAAcW,SAAWb,KAAKG,YAAcH,KAAKI,8BAnF5CN,waCAA4C,aACnB,SAAAA,IAAe3C,EAAAC,KAAA0C,GACb1C,KAAKE,iBACLF,KAAK2C,SACL3C,KAAKG,YAAc,EACnBH,KAAKI,WAAa,kDAQLpE,EAAM0E,GACnBV,KAAKE,cAAcS,MAAM3E,KAAMA,EAAM0E,KAAMA,wCAOhCE,GAAU,IAAAgC,EAAA5C,KACa,IAA9BA,KAAKE,cAAcW,QACrBD,IAGF,IAAIE,EAAkBd,KACtBA,KAAKE,cAAcxB,QAAQ,SAAAqC,GACzB,IAAI8B,EAAM,IAAIC,MACdD,EAAIvD,iBAAiB,OAAQ,WAC3BwB,EAAgBX,aAAe,EAE3BW,EAAgBa,QAClBf,MAED,GACHiC,EAAIvD,iBAAiB,QAAS,WAC5BwB,EAAgBV,YAAc,EAE1BU,EAAgBa,QAClBf,MAED,GACHiC,EAAIE,IAAMhC,EAAKL,KACfkC,EAAKD,MAAM5B,EAAK/E,MAAQ6G,qCAQlB7G,GACR,OAAOgE,KAAK2C,MAAM3G,kCAQlB,OAAOgE,KAAKE,cAAcW,SAAWb,KAAKG,YAAcH,KAAKI,8BA7D5CsC,waCGAM,aACnB,SAAAA,IAAejD,EAAAC,KAAAgD,GACbhD,KAAKiD,uBACLjD,KAAK5C,+EAGiB,IAAAwF,EAAA5C,KACtB3C,OAAOiC,iBAAiB,UAAW,SAAA4D,GAAWN,EAAKxF,mBAAmB8F,EAAMC,MAAO,IACnF9F,OAAOiC,iBAAiB,QAAS,SAAA4D,GAAWN,EAAKxF,mBAAmB8F,EAAMC,MAAO,oDAIjF,OAAOnD,KAAK5C,sCAZK4F","file":"bundle.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2402eded549bdfef3db0","'use strict'\r\n\r\nimport AudioManager from './application/AudioManager'\r\nimport AssetManager from './application/AssetManager'\r\nimport KeyboardEventHandler from './application/KeyboardEventHandler'\r\n\r\nlet socket = io()\r\nlet canvas = document.getElementById('game')\r\nlet keyEventHandler = new KeyboardEventHandler(canvas)\r\nlet audioManager = new AudioManager()\r\nlet assetManager = new AssetManager()\r\nlet playerId\r\nlet ctx\r\n\r\nsocket.on('state', game => {\r\n  console.log('changed state')\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n  console.log(game)\r\n  game.players.forEach(player => {\r\n    if (player.currentArea === game.players[playerId].currentArea) {\r\n      ctx.drawImage(assetManager.getAsset(player.material.name), player.position.x, player.position.y, player.width, player.height)\r\n    }\r\n  })\r\n  game.players[playerId].currentArea.blocks.forEach(block => {\r\n    ctx.drawImage(assetManager.getAsset(block.material.name), block.position.x, block.position.y, block.width, block.height)\r\n  })\r\n})\r\n\r\n/**\r\n *\r\n * @param ctx\r\n * @param canvas\r\n */\r\nfunction animate () {\r\n  // Clear game before drawing new animation\r\n  socket.emit('movement', keyEventHandler.keyActionsRegister)\r\n\r\n  // Request new frame when ready. Allows the game to play in a loop\r\n  window.requestAnimationFrame(() => animate())\r\n}\r\n\r\n/**\r\n * Initializes all game Objects\r\n */\r\nfunction init () {\r\n  audioManager.queueDownload('ambient', 'assets/audio/ambient/ambient.mp3')\r\n  audioManager.queueDownload('jump', 'assets/audio/effects/jump.wav')\r\n  audioManager.loadAll(() => {\r\n    audioManager.playSound('ambient', true)\r\n\r\n    // Add all sprites to the download queue\r\n    assetManager.queueDownload('background', 'assets/textures/background.jpg')\r\n    assetManager.queueDownload('player', 'assets/textures/player.png')\r\n    assetManager.queueDownload('stone-block', 'assets/textures/stone-block.jpg')\r\n    assetManager.queueDownload('heart', 'assets/textures/heart.png')\r\n    // Start playing ambient music\r\n\r\n    // Download all sprites\r\n    assetManager.downLoadAll(() => {\r\n      socket.emit('new player')\r\n    })\r\n  })\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', init())\r\n\r\nsocket.on('message', function (data) {\r\n  console.log(data)\r\n})\r\n\r\nsocket.on('registered player', data => {\r\n  if (canvas.getContext) {\r\n    ctx = canvas.getContext('2d')\r\n    animate()\r\n  } else {\r\n    document.getElementById('unsupported').textContent = 'Please update your browser or download another one which supports HTML5'\r\n  }\r\n})\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/app.js","export default class AudioManager {\n  constructor () {\n    this.bufferCache = []\n    this.downloadQueue = []\n    this.succesCount = 0\n    this.errorCount = 0\n\n    try {\n      // Fix up for prefixing\n      window.AudioContext = window.AudioContext || window.webkitAudioContext\n      this.context = new AudioContext()\n    } catch (e) {\n      alert('Web Audio API is not supported in this browser')\n    }\n  }\n\n  /**\n   *\n   * @param {string} name\n   * @param {string} path\n   */\n  queueDownload (name, path) {\n    this.downloadQueue.push({name: name, path: path})\n  }\n\n  loadAll (callback) {\n    if (this.downloadQueue.length === 0) {\n      callback()\n    }\n    let managerInstance = this\n    this.downloadQueue.forEach(item => {\n      managerInstance.load(item.name, item.path, callback)\n    })\n  }\n\n  load (name, url, callback) {\n    let instance = this\n    let request = new XMLHttpRequest()\n\n    request.open('GET', url, true)\n    request.responseType = 'arraybuffer'\n\n    // Decode asynchronously\n    request.onload = function () {\n      instance.context.decodeAudioData(\n        request.response, buffer => {\n          instance.bufferCache[name] = buffer\n          instance.succesCount += 1\n\n          if (instance.done()) {\n            callback()\n          }\n        }\n      )\n    }\n\n    request.onerror = function () {\n      instance.errorCount += 1\n\n      if (instance.done()) {\n        callback()\n      }\n    }\n    request.send()\n  }\n\n  playSound (name, loop = false) {\n    let sound = this.context.createBufferSource()\n\n    sound.buffer = this.bufferCache[name]\n    sound.connect(this.context.destination)\n    if (loop) {\n      sound.loop = loop\n      sound.loopEnd = Math.floor(sound.buffer.duration)\n    }\n    sound.start(0)\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   */\n  done () {\n    return this.downloadQueue.length === this.succesCount + this.errorCount\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/application/AudioManager.js","export default class AssetManager {\n  constructor () {\n    this.downloadQueue = []\n    this.cache = {}\n    this.succesCount = 0\n    this.errorCount = 0\n  }\n\n  /**\n   *\n   * @param {string} name\n   * @param {string} path\n   */\n  queueDownload (name, path) {\n    this.downloadQueue.push({name: name, path: path})\n  }\n\n  /**\n   *\n   * @param callback\n   */\n  downLoadAll (callback) {\n    if (this.downloadQueue.length === 0) {\n      callback()\n    }\n\n    let managerInstance = this\n    this.downloadQueue.forEach(item => {\n      let img = new Image()\n      img.addEventListener('load', () => {\n        managerInstance.succesCount += 1\n\n        if (managerInstance.done()) {\n          callback()\n        }\n      }, false)\n      img.addEventListener('error', function () {\n        managerInstance.errorCount += 1\n\n        if (managerInstance.done()) {\n          callback()\n        }\n      }, false)\n      img.src = item.path\n      this.cache[item.name] = img\n    })\n  }\n\n  /**\n   *\n   * @param {string} name\n   */\n  getAsset (name) {\n    return this.cache[name]\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   */\n  done () {\n    return this.downloadQueue.length === this.succesCount + this.errorCount\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/application/AssetManager.js","/**\n * Created by Daniel on 2017-09-18.\n */\nexport default class KeyboardEventHandler {\n  constructor () {\n    this.initializeKeyHandler()\n    this.keyActionsRegister = {}\n  }\n\n  initializeKeyHandler () {\n    window.addEventListener('keydown', event => { this.keyActionsRegister[event.key] = true })\n    window.addEventListener('keyup', event => { this.keyActionsRegister[event.key] = false })\n  }\n\n  getKeyActionsRegister () {\n    return this.keyActionsRegister\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/application/KeyboardEventHandler.js"]}
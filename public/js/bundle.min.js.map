{"version":3,"sources":["webpack:/webpack/bootstrap 12fafa99482d80e18826","webpack:///src/client/app.js","webpack:///src/client/application/AudioManager.js","webpack:///src/client/application/AssetManager.js","webpack:///src/client/application/KeyboardEventHandler.js","webpack:///src/client/model/Vector.js"],"names":["__webpack_require__","moduleId","installedModules","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","animate","socket","emit","keyEventHandler","keyActionsRegister","window","requestAnimationFrame","io","connect","canvas","document","getElementById","_KeyboardEventHandler2","default","audioManager","_AudioManager2","assetManager","_AssetManager2","playerId","ctx","spritesLoaded","on","players","clearRect","width","height","keys","forEach","key","player","console","viewport","areaId","getAsset","position","x","y","blocks","block","material","pos","_Vector2","drawImage","lives","engine","id","getContext","queueDownload","loadAll","downLoadAll","textContent","requestAnimFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","element","AudioManager","_classCallCheck","this","bufferCache","downloadQueue","succesCount","AudioContext","webkitAudioContext","context","alert","path","managerInstance","item","load","instance","XMLHttpRequest","request","open","onload","decodeAudioData","response","buffer","onerror","send","undefined","arguments","sound","loop","floor","duration","start","length","errorCount","AssetManager","cache","img","addEventListener","src","KeyboardEventHandler","initializeKeyHandler","event","Vector","vector","scalar","magnitude","normalize","to","Math","pow","v1","v2"],"mappings":"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","file":"bundle.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 12fafa99482d80e18826","'use strict'\r\n\r\nimport AudioManager from './application/AudioManager'\r\nimport AssetManager from './application/AssetManager'\r\nimport KeyboardEventHandler from './application/KeyboardEventHandler'\r\nimport Vector from './model/Vector'\r\n\r\nlet socket = io.connect()\r\nlet canvas = document.getElementById('game')\r\nlet keyEventHandler = new KeyboardEventHandler(canvas)\r\nlet audioManager = new AudioManager()\r\nlet assetManager = new AssetManager()\r\nlet playerId\r\nlet ctx\r\nlet spritesLoaded = false\r\n\r\nfunction animate () {\r\n  socket.emit('movement', keyEventHandler.keyActionsRegister)\r\n  // Request new frame when ready. Allows the game to play in a loop\r\n  window.requestAnimationFrame(() => animate())\r\n}\r\n\r\nsocket.on('state', players => {\r\n  if (playerId && players[playerId] && spritesLoaded) {\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n    Object.keys(players).forEach(key => {\r\n      const player = players[key]\r\n      console.log(player.areaId)\r\n      if (player.viewport.areaId === players[playerId].viewport.areaId) {\r\n        ctx.drawImage(assetManager.getAsset(player.material.name), player.position.x, player.position.y, player.width, player.height)\r\n      }\r\n    })\r\n    players[playerId].viewport.blocks.forEach(block => {\r\n      ctx.drawImage(assetManager.getAsset(block.material.name), block.position.x, block.position.y, block.width, block.height)\r\n    })\r\n    let pos = new Vector(canvas.width - 35, 5)\r\n    for (let i = 0; i < players[playerId].lives; i++) {\r\n      ctx.drawImage(assetManager.cache['heart'], pos.x, pos.y, 30, 30)\r\n      pos.x -= 30\r\n    }\r\n  }\r\n})\r\n\r\n/**\r\n * Initializes all game Objects\r\n */\r\nfunction init () {\r\n  if (canvas.getContext) {\r\n    socket.emit('new player')\r\n    ctx = canvas.getContext('2d')\r\n    audioManager.queueDownload('ambient', 'assets/audio/ambient/ambient.mp3')\r\n    audioManager.queueDownload('jump', 'assets/audio/effects/jump.wav')\r\n    audioManager.loadAll(() => {\r\n      audioManager.playSound('ambient', true)\r\n\r\n      // Add all sprites to the download queue\r\n      assetManager.queueDownload('background', 'assets/textures/background.png')\r\n      assetManager.queueDownload('player', 'assets/textures/player.png')\r\n      assetManager.queueDownload('stone-block', 'assets/textures/stone-block.jpg')\r\n      assetManager.queueDownload('heart', 'assets/textures/heart.png')\r\n      // Start playing ambient music\r\n\r\n      // Download all sprites\r\n      assetManager.downLoadAll(() => {\r\n        animate()\r\n        document.getElementById('background').getContext('2d').drawImage(assetManager.getAsset('background'), 0, 0, canvas.width, canvas.height)\r\n        spritesLoaded = true\r\n      })\r\n    })\r\n  } else {\r\n    document.getElementById('unsupported').textContent = 'Please update your browser or download another one which supports HTML5'\r\n  }\r\n}\r\n\r\nsocket.on('connect', function () {\r\n  socket.emit('new player')\r\n  playerId = socket.io.engine.id\r\n})\r\n\r\ndocument.addEventListener('DOMContentLoaded', init())\r\n\r\n/**\r\n *\r\n */\r\nwindow.requestAnimFrame = (function () {\r\n  return window.requestAnimationFrame ||\r\n    window.webkitRequestAnimationFrame ||\r\n    window.mozRequestAnimationFrame ||\r\n    window.oRequestAnimationFrame ||\r\n    window.msRequestAnimationFrame ||\r\n    function (/* function */ callback, /* DOMElement */ element) {\r\n      window.setTimeout(callback, 1000 / 60)\r\n    }\r\n})()\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/app.js","export default class AudioManager {\n  constructor () {\n    this.bufferCache = []\n    this.downloadQueue = []\n    this.succesCount = 0\n    this.errorCount = 0\n\n    try {\n      // Fix up for prefixing\n      window.AudioContext = window.AudioContext || window.webkitAudioContext\n      this.context = new AudioContext()\n    } catch (e) {\n      alert('Web Audio API is not supported in this browser')\n    }\n  }\n\n  /**\n   *\n   * @param {string} name\n   * @param {string} path\n   */\n  queueDownload (name, path) {\n    this.downloadQueue.push({name: name, path: path})\n  }\n\n  loadAll (callback) {\n    if (this.downloadQueue.length === 0) {\n      callback()\n    }\n    let managerInstance = this\n    this.downloadQueue.forEach(item => {\n      managerInstance.load(item.name, item.path, callback)\n    })\n  }\n\n  load (name, url, callback) {\n    let instance = this\n    let request = new XMLHttpRequest()\n\n    request.open('GET', url, true)\n    request.responseType = 'arraybuffer'\n\n    // Decode asynchronously\n    request.onload = function () {\n      instance.context.decodeAudioData(\n        request.response, buffer => {\n          instance.bufferCache[name] = buffer\n          instance.succesCount += 1\n\n          if (instance.done()) {\n            callback()\n          }\n        }\n      )\n    }\n\n    request.onerror = function () {\n      instance.errorCount += 1\n\n      if (instance.done()) {\n        callback()\n      }\n    }\n    request.send()\n  }\n\n  playSound (name, loop = false) {\n    let sound = this.context.createBufferSource()\n\n    sound.buffer = this.bufferCache[name]\n    sound.connect(this.context.destination)\n    if (loop) {\n      sound.loop = loop\n      sound.loopEnd = Math.floor(sound.buffer.duration)\n    }\n    sound.start(0)\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   */\n  done () {\n    return this.downloadQueue.length === this.succesCount + this.errorCount\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/application/AudioManager.js","export default class AssetManager {\n  constructor () {\n    this.downloadQueue = []\n    this.cache = {}\n    this.succesCount = 0\n    this.errorCount = 0\n  }\n\n  /**\n   *\n   * @param {string} name\n   * @param {string} path\n   */\n  queueDownload (name, path) {\n    this.downloadQueue.push({name: name, path: path})\n  }\n\n  /**\n   *\n   * @param callback\n   */\n  downLoadAll (callback) {\n    if (this.downloadQueue.length === 0) {\n      callback()\n    }\n\n    let managerInstance = this\n    this.downloadQueue.forEach(item => {\n      let img = new Image()\n      img.addEventListener('load', () => {\n        managerInstance.succesCount += 1\n\n        if (managerInstance.done()) {\n          callback()\n        }\n      }, false)\n      img.addEventListener('error', function () {\n        managerInstance.errorCount += 1\n\n        if (managerInstance.done()) {\n          callback()\n        }\n      }, false)\n      img.src = item.path\n      this.cache[item.name] = img\n    })\n  }\n\n  /**\n   *\n   * @param {string} name\n   */\n  getAsset (name) {\n    return this.cache[name]\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   */\n  done () {\n    return this.downloadQueue.length === this.succesCount + this.errorCount\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/application/AssetManager.js","/**\n * Created by Daniel on 2017-09-18.\n */\nexport default class KeyboardEventHandler {\n  constructor () {\n    this.initializeKeyHandler()\n    this.keyActionsRegister = {}\n  }\n\n  initializeKeyHandler () {\n    window.addEventListener('keydown', event => { this.keyActionsRegister[event.key] = true })\n    window.addEventListener('keyup', event => { this.keyActionsRegister[event.key] = false })\n  }\n\n  getKeyActionsRegister () {\n    return this.keyActionsRegister\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/application/KeyboardEventHandler.js","/**\n * @author Daniel Peters\n * @version 1.0\n */\nexport default class Vector {\n  /**\n   *\n   * @param {number} x\n   * @param {number} y\n   */\n  constructor (x, y) {\n    this.x = x\n    this.y = y\n  }\n\n  set (x, y) {\n    this.x = x\n    this.y = y\n  }\n\n  setVector (vector) {\n    this.x = vector.x\n    this.y = vector.y\n  }\n\n  add (vector) {\n    this.x += vector.x\n    this.y += vector.y\n  }\n\n  static add (v1, v2) {\n    return new Vector(v1.x + v2.x, v1.y + v2.y)\n  }\n\n  sub (vector) {\n    this.x -= vector.x\n    this.y -= vector.y\n  }\n\n  static sub (v1, v2) {\n    return new Vector(v1.x - v2.x, v1.y - v2.y)\n  }\n\n  mult (scalar) {\n    this.x *= scalar\n    this.y *= scalar\n  }\n\n  static mult (vector, scalar) {\n    return new Vector(vector.x * scalar, vector.y * scalar)\n  }\n\n  div (scalar) {\n    this.x /= scalar\n    this.y /= scalar\n  }\n\n  static div (vector, scalar) {\n    return new Vector(vector.x / scalar, vector.y / scalar)\n  }\n\n  mag () {\n    return Math.sqrt(this.x * this.x + this.y * this.y)\n  }\n\n  negative () {\n    return new Vector(-this.x, -this.y)\n  }\n\n  normalize () {\n    let magnitude = this.mag()\n    if (magnitude !== 0) {\n      this.div(magnitude)\n    }\n  }\n\n  limit (max) {\n    if (this.mag() > max) {\n      this.normalize()\n      this.mult(max)\n    }\n  }\n\n  heading () {\n\n  }\n\n  rotate () {\n\n  }\n\n  lerp () {\n\n  }\n\n  distanceTo (to) {\n    return Math.sqrt(Math.pow(to.x - this.x, 2) + Math.pow(to.y - this.y, 2))\n  }\n\n  angleBetween () {\n\n  }\n\n  dot () {\n\n  }\n\n  cross () {\n\n  }\n\n  random2D () {\n\n  }\n\n  random3D () {\n\n  }\n\n  clone () {\n    return new Vector(this.x, this.y)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/model/Vector.js"]}
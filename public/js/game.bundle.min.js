"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(t,n){var i=new XMLHttpRequest;i.addEventListener("load",function(){n(i.response)}),i.open(t.method?t.method:e.defaults.method,t.url?t.url:e.defaults.url,t.async?t.async:e.defaults.async),t.hasOwnProperty("contentType")&&i.setRequestHeader("Content-Type",t.contentType?t.contentType:e.defaults.contentType),t.hasOwnProperty("responseType")&&(i.responseType=t.responseType),t.hasOwnProperty("data")&&"object"===_typeof(t.data)&&(t.data=JSON.stringify(t.data)),i.send(t.data?t.data:null)}}]),e}();i.defaults={url:"",method:"GET",contentType:"text/html",async:!0,data:null},t.Ajax=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(4);!function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT",e.SHOOT="SHOOT",e.RESTART="RESTART",e.JUMP="JUMP"}(t.Actions||(t.Actions={}));var s=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.inputMap=e.keyBoard,n.init(),n.initializeTouchHandler(),n.touches={start:[],move:[]},n}return _inherits(t,i.Observable),_createClass(t,[{key:"init",value:function(){var e=this;window.addEventListener("keydown",function(t){var n=" "!==t.key?t.key:"space";e.state[e.inputMap[n]]=!0,e.notify()}),window.addEventListener("keyup",function(t){var n=" "!==t.key?t.key:"space";e.state[e.inputMap[n]]=!1,e.notify()})}},{key:"initializeTouchHandler",value:function(){var e=document.getElementById("move"),t=e||window;t.addEventListener("touchstart",function(e){e.preventDefault(),n=e.touches,s=e.touches[0].pageX,a=e.touches[0].pageY},!1),t.addEventListener("touchmove",function(e){u.reset(),e.preventDefault(),i=e.changedTouches,o=e.touches[0].pageX,r=e.touches[0].pageY;for(var t=0;t<e.touches.length;t++)i[t].pageX<n[t].pageX&&(u.state[u.inputMap.a]=!0),i[t].pageX>n[t].pageX&&(u.state[u.inputMap.d]=!0),i[t].pageY<n[t].pageY&&(u.state[u.inputMap.w]=!0),i[t].pageY>n[t].pageY&&(u.state[u.inputMap.s]=!0),u.notify()},!1),t.addEventListener("touchend",function(e){e.preventDefault(),u.reset()},!1),t.addEventListener("contextmenu",function(e){return e.preventDefault(),!1});var n=[],i=[],s=0,a=0,o=0,r=0,u=this}},{key:"shoot",value:function(){this.state[this.inputMap.space]=!0}},{key:"cancelShoot",value:function(){this.state[this.inputMap.space]=!1}},{key:"reset",value:function(){this.state[this.inputMap.w]=!1,this.state[this.inputMap.a]=!1,this.state[this.inputMap.s]=!1,this.state[this.inputMap.d]=!1}}]),t}();t.InputManager=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s=n(11);document.addEventListener("DOMContentLoaded",function(){var e=io(),t=new s.default(e),n=new i.default(t,document.getElementById("game"));console.log("hi"),e.on("connect",function(){e.emit("new player"),n.playerId=e.io.engine.id}),e.on("state",function(e){n.render(e)})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),s=n(5),a=n(8),o=n(9),r=n(10),u=function(){function e(t,n){_classCallCheck(this,e),this.settings=new r.Settings,this.canvas=n,this.backgroundCanvas=document.getElementById("background"),this.inputManager=new i.InputManager(this.settings),this.inputManager.observers.push(t),this.inputManager.observers.push(this),this.assetManager=new s.AssetManager,this.spritesLoaded=!1,this.ctx=null,this.animations={},this.init()}return _createClass(e,[{key:"init",value:function(){var e=this;console.log("start"),this.canvas.getContext?(this.ctx=this.canvas.getContext("2d"),this.assetManager.queueDownload(o.EntityType.MAIN_THEME,"assets/audio/ambient/ambient.mp3",s.AssetType.AUDIO),this.assetManager.queueDownload(o.EntityType.JUMP,"assets/audio/effects/jump.wav",s.AssetType.AUDIO),this.assetManager.queueDownload(o.EntityType.BACKGROUND,"assets/textures/background.png",s.AssetType.SPRITE),this.assetManager.queueDownload(o.EntityType.PLAYER,"assets/textures/player.png",s.AssetType.SPRITE),this.assetManager.queueDownload(o.EntityType.STONE,"assets/textures/stone-block.jpg",s.AssetType.SPRITE),this.assetManager.queueDownload(o.EntityType.HEART,"assets/textures/heart.png",s.AssetType.SPRITE),this.assetManager.queueDownload(o.EntityType.COIN,"assets/textures/coin.png",s.AssetType.SPRITE),this.assetManager.queueDownload(o.EntityType.PLAYER_SHEET,"assets/textures/test.png",s.AssetType.SPRITE_SHEET,{frameWidth:32,frameHeight:64}),this.assetManager.queueDownload(o.EntityType.COIN_SHEET,"assets/textures/coin-sprite-animation-sprite-sheet.png",s.AssetType.SPRITE_SHEET,{frameWidth:44,frameHeight:44}),this.assetManager.downloadAll(function(){e.animations.right=new a.default(e.assetManager.getSpriteSheet(o.EntityType.PLAYER_SHEET),3,3,6,12),e.animations.left=new a.default(e.assetManager.getSpriteSheet(o.EntityType.PLAYER_SHEET),3,3,6,12),e.animations.idle=new a.default(e.assetManager.getSpriteSheet(o.EntityType.PLAYER_SHEET),10,0,2,12),e.animations.coin=new a.default(e.assetManager.getSpriteSheet(o.EntityType.COIN_SHEET),3,0,9),e.animations.current=e.animations.left,e.assetManager.getSound(o.EntityType.MAIN_THEME,s.AssetType.AUDIO_LOOP).play(!0),e.backgroundCanvas.getContext("2d").drawImage(e.assetManager.getSprite(o.EntityType.BACKGROUND),0,0,e.canvas.width,e.canvas.height),e.spritesLoaded=!0,e.loop()})):document.getElementById("unsupported").textContent="Please update your browser or download another one which supports HTML5"}},{key:"update",value:function(e){this.state=e}},{key:"loop",value:function(){var e=this;this.inputManager.notify(),window.requestAnimationFrame(function(){return e.loop()})}},{key:"render",value:function(e){var t=this,n=e.find(function(e){return e.id===t.playerId});if(this.playerId&&n&&this.spritesLoaded){(this.state[i.Actions.UP]||this.state[i.Actions.JUMP])&&!n.jumping&&n.grounded&&this.assetManager.getSound(o.EntityType.JUMP,s.AssetType.AUDIO).play(),this.animations.current.update(),this.animations.coin.update(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),e.forEach(function(e){e.viewport.areaId===n.viewport.areaId&&(e.registeredInputs[i.Actions.LEFT]&&(t.animations.current=t.animations.left),e.registeredInputs[i.Actions.RIGHT]&&(t.animations.current=t.animations.right),e.registeredInputs[i.Actions.LEFT]||e.registeredInputs[i.Actions.RIGHT]||(t.animations.current=t.animations.idle),t.animations.current.draw(t.ctx,e.position._x,e.position._y,e.width,e.height))}),n.viewport.blocks.forEach(function(e){"stone"===e.type?t.ctx.drawImage(t.assetManager.getSprite(e.type),e.position._x,e.position._y,e.width,e.height):"coin"===e.type&&t.animations.coin.draw(t.ctx,e.position._x,e.position._y,e.width,e.height)});for(var a=this.canvas.width-35,r=0;r<n.lives;r++)this.ctx.drawImage(this.assetManager.getSprite(o.EntityType.HEART),a,5,30,30),a-=30;this.ctx.drawImage(this.assetManager.getSprite(o.EntityType.COIN),5,5,30,30),this.ctx.font="30px sans-serif",this.ctx.fillStyle="#081966",this.ctx.fillText(n.coins.toString(),35,30)}}}]),e}();t.default=u},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){_classCallCheck(this,e),this._observers=[],this._state={}}return _createClass(e,[{key:"register",value:function(e){this._observers.push(e)}},{key:"unRegister",value:function(e){this._observers=this._observers.filter(function(t){return t!==e})}},{key:"notify",value:function(){var e=this;this._observers.forEach(function(t){t.update(e._state)})}},{key:"observers",get:function(){return this._observers},set:function(e){this._observers=e}},{key:"state",get:function(){return this._state},set:function(e){this._state=e}}]),e}();t.Observable=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i,s=n(0),a=n(6),o=n(7);!function(e){e.SPRITE="SPRITE",e.SPRITE_SHEET="SPRITE_SHEET",e.AUDIO="AUDIO",e.AUDIO_LOOP="LOOP"}(i=t.AssetType||(t.AssetType={}));var r=function(){function e(){_classCallCheck(this,e),this.cache={sprites:{},spriteSheets:{},audio:{}},this.downloadCount=0,this.queue=[],this.initAudioContext()}return _createClass(e,[{key:"initAudioContext",value:function(){try{window.AudioContext=window.AudioContext||webkitAudioContext,this.audioContext=new AudioContext,this.masterGain=this.audioContext.createGain(),this.effectsGain=this.audioContext.createGain(),this.ambientGain=this.audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.audioContext.destination),this.effectsGain.connect(this.masterGain),this.ambientGain.connect(this.masterGain),this.ambientGain.gain.value=1,this.effectsGain.gain.value=1}catch(e){console.log("Web Audio API is not supported in this browser")}}},{key:"adjustMasterVolume",value:function(e){this.masterGain.gain.value=e}},{key:"adjustAmbientVolume",value:function(e){this.ambientGain.gain.value=e}},{key:"adjustEffectsVolume",value:function(e){this.effectsGain.gain.value=e}},{key:"done",value:function(){return this.downloadCount===this.queue.length}},{key:"queueDownload",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.queue.push({id:e,path:t,type:n,opts:i})}},{key:"loadAudioFromUrl",value:function(e,t){var n=this;s.Ajax.create({method:"GET",url:e.path,responseType:"arraybuffer"},function(i){n.decodeAudio(i,e.id,t)})}},{key:"decodeAudio",value:function(e,t,n){var i=this;this.audioContext.decodeAudioData(e).then(function(e){i.cache.audio[t]=e,i.downloadCount+=1,i.done()&&n()},function(e){console.log("Error with decoding audio data"+e)})}},{key:"loadSprite",value:function(e,t){var n=this,i=new Image;i.addEventListener("load",function(){n.downloadCount++,n.done()&&t()}),i.src=e.path,this.cache.sprites[e.id]=i}},{key:"loadSpriteSheet",value:function(e,t){var n=this,i=new Image;i.addEventListener("load",function(){n.cache.spriteSheets[e.id]=new a.SpriteSheet(i,e.opts.frameWidth||0,e.opts.frameHeight||0),n.downloadCount+=1,n.done()&&t()}),i.src=e.path}},{key:"downloadAll",value:function(e){var t=this;this.queue.forEach(function(n){n.type===i.AUDIO?t.loadAudioFromUrl(n,e):n.type===i.SPRITE?t.loadSprite(n,e):n.type===i.SPRITE_SHEET&&t.loadSpriteSheet(n,e)})}},{key:"getSound",value:function(e,t){var n=void 0;return n=t===i.AUDIO?this.effectsGain:this.ambientGain,new o.Sound(this.audioContext,n,this.cache.audio[e])}},{key:"getSprite",value:function(e){return this.cache.sprites[e]}},{key:"getSpriteSheet",value:function(e){return this.cache.spriteSheets[e]}}]),e}();t.AssetManager=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t,n,i){_classCallCheck(this,e),this._image=t,this._frameWidth=n,this._frameHeight=i,this._framesPerRow=Math.floor(this._image.width/this._frameWidth)}return _createClass(e,[{key:"image",get:function(){return this._image},set:function(e){if(!(e instanceof Image))throw new Error("Param tileSetImage must be of type Image!");this._image=e}},{key:"frameWidth",get:function(){return this._frameWidth},set:function(e){this._frameWidth=e}},{key:"frameHeight",get:function(){return this._frameHeight},set:function(e){this._frameHeight=e}},{key:"framesPerRow",get:function(){return this._framesPerRow},set:function(e){this._framesPerRow=e}}]),e}();t.SpriteSheet=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t,n,i){_classCallCheck(this,e),this.audioContext=t,this.masterGain=n,this.buffer=i,this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=.2,this.gainNode.connect(this.masterGain),this.playing=!1}return _createClass(e,[{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.source=this.audioContext.createBufferSource(),this.source.buffer=this.buffer,this.source.loop=e,this.source.connect(this.gainNode),this.source.start(0)}},{key:"stop",value:function(){this.source.stop(0)}}]),e}();t.Sound=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t,n,i,s){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;_classCallCheck(this,e),this.spriteSheet=t,this.speed=n,this.sequence=[],this.currentFrame=0,this.counter=0,this.offsetBottom=a;for(var o=i;o<=s;o++)this.sequence.push(o)}return _createClass(e,[{key:"update",value:function(){this.counter===this.speed-1&&(this.currentFrame=(this.currentFrame+1)%this.sequence.length),this.counter=(this.counter+1)%this.speed}},{key:"draw",value:function(e,t,n,i,s){var a=Math.floor(this.sequence[this.currentFrame]/this.spriteSheet.framesPerRow),o=Math.floor(this.sequence[this.currentFrame]%this.spriteSheet.framesPerRow);e.drawImage(this.spriteSheet.image,o*this.spriteSheet.frameWidth,a*this.spriteSheet.frameHeight,this.spriteSheet.frameWidth,this.spriteSheet.frameHeight-this.offsetBottom,t,n,i,s)}}]),e}();t.default=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});!function(e){e.PLAYER="ship",e.ENEMY="enmey",e.ENEMY_BULLET="bulletEnemy",e.PLAYER_BULLET="bullet",e.BACKGROUND="background",e.MAP="map",e.GAME_OVER="gameOver",e.LASER="laser",e.MAIN_THEME="shockWave",e.EXPLOSION_I="explosion1",e.EXPLOSION_II="explosion2",e.BOX="box",e.JUMP="jump",e.STONE="stone",e.HEART="heart",e.COIN="coint",e.PLAYER_SHEET="playerSheet",e.COIN_SHEET="cointSheet"}(t.EntityType||(t.EntityType={}))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);t.Settings=function e(){_classCallCheck(this,e),this.canvasWidth=900,this.canvasHeight=480,this.keyBoard={w:i.Actions.UP,s:i.Actions.DOWN,a:i.Actions.LEFT,d:i.Actions.RIGHT,space:i.Actions.JUMP,r:i.Actions.RESTART},this.player={maxVelocity:15,fireDelay:15,friction:.7,acceleration:3},this.audio={master:1,ambient:1,effects:1}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t){_classCallCheck(this,e),this.socket=t}return _createClass(e,[{key:"update",value:function(e){this.socket.emit("input",e)}}]),e}();t.default=i}]);
//# sourceMappingURL=game.bundle.min.js.map

{"version":3,"sources":["webpack:///webpack/bootstrap 2402eded549bdfef3db0","webpack:///./src/client/app.js","webpack:///./src/client/application/AudioManager.js","webpack:///./src/client/application/AssetManager.js","webpack:///./src/client/application/KeyboardEventHandler.js"],"names":["socket","io","canvas","document","getElementById","keyEventHandler","audioManager","assetManager","playerId","ctx","on","console","log","clearRect","width","height","game","players","forEach","player","currentArea","drawImage","getAsset","material","name","position","x","y","blocks","block","animate","emit","keyActionsRegister","window","requestAnimationFrame","init","queueDownload","loadAll","playSound","downLoadAll","addEventListener","data","getContext","textContent","AudioManager","bufferCache","downloadQueue","succesCount","errorCount","AudioContext","webkitAudioContext","context","e","alert","path","push","callback","length","managerInstance","load","item","url","instance","request","XMLHttpRequest","open","responseType","onload","decodeAudioData","response","buffer","done","onerror","send","loop","sound","createBufferSource","connect","destination","loopEnd","Math","floor","duration","start","AssetManager","cache","img","Image","src","KeyboardEventHandler","initializeKeyHandler","event","key"],"mappings":"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","file":"./public/js/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2402eded549bdfef3db0","'use strict'\r\n\r\nimport AudioManager from './application/AudioManager'\r\nimport AssetManager from './application/AssetManager'\r\nimport KeyboardEventHandler from './application/KeyboardEventHandler'\r\n\r\nlet socket = io()\r\nlet canvas = document.getElementById('game')\r\nlet keyEventHandler = new KeyboardEventHandler(canvas)\r\nlet audioManager = new AudioManager()\r\nlet assetManager = new AssetManager()\r\nlet playerId\r\nlet ctx\r\n\r\nsocket.on('state', game => {\r\n  console.log('changed state')\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n  console.log(game)\r\n  game.players.forEach(player => {\r\n    if (player.currentArea === game.players[playerId].currentArea) {\r\n      ctx.drawImage(assetManager.getAsset(player.material.name), player.position.x, player.position.y, player.width, player.height)\r\n    }\r\n  })\r\n  game.players[playerId].currentArea.blocks.forEach(block => {\r\n    ctx.drawImage(assetManager.getAsset(block.material.name), block.position.x, block.position.y, block.width, block.height)\r\n  })\r\n})\r\n\r\n/**\r\n *\r\n * @param ctx\r\n * @param canvas\r\n */\r\nfunction animate () {\r\n  // Clear game before drawing new animation\r\n  socket.emit('movement', keyEventHandler.keyActionsRegister)\r\n\r\n  // Request new frame when ready. Allows the game to play in a loop\r\n  window.requestAnimationFrame(() => animate())\r\n}\r\n\r\n/**\r\n * Initializes all game Objects\r\n */\r\nfunction init () {\r\n  audioManager.queueDownload('ambient', 'assets/audio/ambient/ambient.mp3')\r\n  audioManager.queueDownload('jump', 'assets/audio/effects/jump.wav')\r\n  audioManager.loadAll(() => {\r\n    audioManager.playSound('ambient', true)\r\n\r\n    // Add all sprites to the download queue\r\n    assetManager.queueDownload('background', 'assets/textures/background.jpg')\r\n    assetManager.queueDownload('player', 'assets/textures/player.png')\r\n    assetManager.queueDownload('stone-block', 'assets/textures/stone-block.jpg')\r\n    assetManager.queueDownload('heart', 'assets/textures/heart.png')\r\n    // Start playing ambient music\r\n\r\n    // Download all sprites\r\n    assetManager.downLoadAll(() => {\r\n      socket.emit('new player')\r\n    })\r\n  })\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', init())\r\n\r\nsocket.on('message', function (data) {\r\n  console.log(data)\r\n})\r\n\r\nsocket.on('registered player', data => {\r\n  if (canvas.getContext) {\r\n    ctx = canvas.getContext('2d')\r\n    animate()\r\n  } else {\r\n    document.getElementById('unsupported').textContent = 'Please update your browser or download another one which supports HTML5'\r\n  }\r\n})\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/app.js","export default class AudioManager {\n  constructor () {\n    this.bufferCache = []\n    this.downloadQueue = []\n    this.succesCount = 0\n    this.errorCount = 0\n\n    try {\n      // Fix up for prefixing\n      window.AudioContext = window.AudioContext || window.webkitAudioContext\n      this.context = new AudioContext()\n    } catch (e) {\n      alert('Web Audio API is not supported in this browser')\n    }\n  }\n\n  /**\n   *\n   * @param {string} name\n   * @param {string} path\n   */\n  queueDownload (name, path) {\n    this.downloadQueue.push({name: name, path: path})\n  }\n\n  loadAll (callback) {\n    if (this.downloadQueue.length === 0) {\n      callback()\n    }\n    let managerInstance = this\n    this.downloadQueue.forEach(item => {\n      managerInstance.load(item.name, item.path, callback)\n    })\n  }\n\n  load (name, url, callback) {\n    let instance = this\n    let request = new XMLHttpRequest()\n\n    request.open('GET', url, true)\n    request.responseType = 'arraybuffer'\n\n    // Decode asynchronously\n    request.onload = function () {\n      instance.context.decodeAudioData(\n        request.response, buffer => {\n          instance.bufferCache[name] = buffer\n          instance.succesCount += 1\n\n          if (instance.done()) {\n            callback()\n          }\n        }\n      )\n    }\n\n    request.onerror = function () {\n      instance.errorCount += 1\n\n      if (instance.done()) {\n        callback()\n      }\n    }\n    request.send()\n  }\n\n  playSound (name, loop = false) {\n    let sound = this.context.createBufferSource()\n\n    sound.buffer = this.bufferCache[name]\n    sound.connect(this.context.destination)\n    if (loop) {\n      sound.loop = loop\n      sound.loopEnd = Math.floor(sound.buffer.duration)\n    }\n    sound.start(0)\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   */\n  done () {\n    return this.downloadQueue.length === this.succesCount + this.errorCount\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/application/AudioManager.js","export default class AssetManager {\n  constructor () {\n    this.downloadQueue = []\n    this.cache = {}\n    this.succesCount = 0\n    this.errorCount = 0\n  }\n\n  /**\n   *\n   * @param {string} name\n   * @param {string} path\n   */\n  queueDownload (name, path) {\n    this.downloadQueue.push({name: name, path: path})\n  }\n\n  /**\n   *\n   * @param callback\n   */\n  downLoadAll (callback) {\n    if (this.downloadQueue.length === 0) {\n      callback()\n    }\n\n    let managerInstance = this\n    this.downloadQueue.forEach(item => {\n      let img = new Image()\n      img.addEventListener('load', () => {\n        managerInstance.succesCount += 1\n\n        if (managerInstance.done()) {\n          callback()\n        }\n      }, false)\n      img.addEventListener('error', function () {\n        managerInstance.errorCount += 1\n\n        if (managerInstance.done()) {\n          callback()\n        }\n      }, false)\n      img.src = item.path\n      this.cache[item.name] = img\n    })\n  }\n\n  /**\n   *\n   * @param {string} name\n   */\n  getAsset (name) {\n    return this.cache[name]\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   */\n  done () {\n    return this.downloadQueue.length === this.succesCount + this.errorCount\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/application/AssetManager.js","/**\n * Created by Daniel on 2017-09-18.\n */\nexport default class KeyboardEventHandler {\n  constructor () {\n    this.initializeKeyHandler()\n    this.keyActionsRegister = {}\n  }\n\n  initializeKeyHandler () {\n    window.addEventListener('keydown', event => { this.keyActionsRegister[event.key] = true })\n    window.addEventListener('keyup', event => { this.keyActionsRegister[event.key] = false })\n  }\n\n  getKeyActionsRegister () {\n    return this.keyActionsRegister\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/application/KeyboardEventHandler.js"],"sourceRoot":""}